<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>

<body>


    <div class="main">
        <nav class="doctor-dash">
        <p class="welcome">Welcome Dr. {{Doc_name}}</p>
        <div class="logout">
            <a href="/logout" class="lout">Log out</a>
        </div>
    </nav>

        <!-- ================== Doctors ================== -->
        <div class="section-header">
            <p class="section-title">Registered Doctors</p>

            <div class="section-actions">
                <input type="text" class="search-box" placeholder="Search doctors..." data-section="doctors">
                <a class="create-btn" href="/Admin_Dashboard/doc_registration.html">Register</a>
            </div>
        </div>

        <div class="doctors">
            {% for doctor in doctors %}
            <div class="row">
                <span class="name">{{ doctor.username }}</span>
                <div class="btn">
                    <a href="/Admin_Dashboard/edit_doc.html?id={{ doctor['id'] }}" class="btn-edit">Edit</a>
                    <a href="/Admin_Dashboard/delete?id={{ doctor['id'] }}" class="btn-delete">Delete</a>

                    {% if doctor['is_blacklisted'] == 1 %}
                    <a href="/Admin_Dashboard/toggle_blacklist?id={{ doctor['id'] }}" class="btn-unblacklist">
                        Unblacklist
                    </a>
                    {% else %}
                    <a href="/Admin_Dashboard/toggle_blacklist?id={{ doctor['id'] }}" class="btn-blacklist">
                        Blacklist
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

        </div>


        <!-- ================== Patients ================== -->
        <div class="section-header">
            <p class="section-title">Registered Patients</p>

            <div class="section-actions">
                <input type="text" class="search-box" placeholder="Search patients..." data-section="patients">
            </div>
        </div>

        <div class="patients">
            {% for patient in patients %}
            <div class="row">   
                <span class="name">{{ patient.username }}</span>
                <div class="btn">
                    <a href="/Admin_Dashboard/edit_pat.html?id={{ patient['id'] }}" class="btn-edit">Edit</a>
                    <a href="/Admin_Dashboard/delete_patient?id={{ patient['id'] }}" class="btn-delete">Delete</a>

                    {% if patient['is_blacklisted'] == 1 %}
                    <a href="/Admin_Dashboard/toggle_blacklist_patient?id={{ patient['id'] }}"
                        class="btn-unblacklist">Unblacklist</a>
                    {% else %}
                    <a href="/Admin_Dashboard/toggle_blacklist_patient?id={{ patient['id'] }}"
                        class="btn-blacklist">Blacklist</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

        </div>


        <!-- ================== Appointments ================== -->
        <div class="section-header">
            <p class="section-title">Upcoming Appointments</p>
            <div class="section-actions">
                <input type="text" class="search-box" placeholder="Search appointments..." data-section="appointments">
            </div>
        </div>

        <div class="appointments">
            <table>
                <thead>
                    <tr>
                        <th>Sr No.</th>
                        <th>Patient Name</th>
                        <th>Doctor Name</th>
                        <th>Department</th>
                        <th>Patient History</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appt in appointments %}
                    <tr>
                        <td>{{ appt.sr_no }}</td>
                        <td>{{ appt.patient_name }}</td>
                        <td>{{ appt.doctor_name }}</td>
                        <td>{{ appt.department }}</td>
                        <td><a href="/Admin_Dashboard/view_pat.html?id={{ appt.patient_row_id }}" class="btn-view">View</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>

    </div>



    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const searchBoxes = document.querySelectorAll(".search-box");

            searchBoxes.forEach(box => {
                box.addEventListener("keyup", () => {
                    const filter = box.value.toLowerCase();

                    // Find the nearest parent .section-header, then its next .box
                    const sectionBox = box.closest(".section-header").nextElementSibling;

                    if (!sectionBox) return;

                    // For appointments, the rows are in a table; for others, in div.row
                    let rows;
                    if (sectionBox.querySelector("table")) {
                        rows = sectionBox.querySelectorAll("tbody tr");
                    } else {
                        rows = sectionBox.querySelectorAll(".row");
                    }

                    rows.forEach(item => {
                        const text = item.textContent.toLowerCase();
                        item.style.display = text.includes(filter) ? "" : "none";
                    });
                });
            });
        });
    </script>




</body>

</html>